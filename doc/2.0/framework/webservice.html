

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Creating MapFish Web Services &mdash; MapFish v2.0 documentation</title>
    <link rel="stylesheet" href="../_static/mapfish.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="MapFish v2.0 documentation" href="../index.html" />
    <link rel="up" title="Framework" href="index.html" />
    <link rel="next" title="Customizing Web Services" href="customizing-webservices.html" />
    <link rel="prev" title="Installing the JavaScript toolbox" href="javascript-toolbox.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="customizing-webservices.html" title="Customizing Web Services"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="javascript-toolbox.html" title="Installing the JavaScript toolbox"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">MapFish v2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Framework</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="javascript-toolbox.html"
                        title="previous chapter">Installing the JavaScript toolbox</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="customizing-webservices.html"
                        title="next chapter">Customizing Web Services</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/framework/webservice.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="creating-mapfish-web-services">
<h1>Creating MapFish Web Services<a class="headerlink" href="#creating-mapfish-web-services" title="Permalink to this headline">Â¶</a></h1>
<p>The framework provides a command for automatically generating web services for
creating, reading, updating and deleting geographic objects (features). Web
services generated with the framework implement specific HTTP interfaces.
These interfaces are described in <a class="reference external" href="../protocol.html">Protocol page</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">MapFish web services are also called <cite>layers</cite>, both terms will be used
interchangeably in the rest of this documentation.</p>
</div>
<p>A MapFish web service generated by the framework operates on the data of a
geographic database table. Because MapFish uses <a class="reference external" href="http://geoalchemy.org/">GeoAlchemy</a>
several databases are supported (as of today: PostgreSQL/PostGIS, MySQL, SQLite/Spatialite
and Oracle).</p>
<p>It is important to note that the code of generated web services belongs to the
application. You, as the application developer, can therefore customize the generated
web services at will. You are completely free to not rely on code generation,
and manually create your web services.</p>
<p>Before you can have working MapFish web services you need to configure a
database connection in the application&#8217;s configuration file (<tt class="docutils literal"><span class="pre">development.ini</span></tt>).
A database connection is set through the <tt class="docutils literal"><span class="pre">sqlalchemy.url</span></tt> property. This
specifies the data source name (DSN) for the database, for PostgreSQL/PostGIS
it looks like this:</p>
<div class="highlight-python"><pre>sqlalchemy.url = postgresql://username:password@host:port/database</pre>
</div>
<p>Creating a MapFish web service is done in two steps. The first step involves
describing the database table in the <tt class="docutils literal"><span class="pre">layers.ini</span></tt> configuration file. The
second step involves invoking the <tt class="docutils literal"><span class="pre">paster</span> <span class="pre">mf-layer</span></tt> command.</p>
<dl class="docutils" id="layer-ini-2-0">
<dt><tt class="docutils literal"><span class="pre">layers.ini</span></tt></dt>
<dd><p class="first">The <tt class="docutils literal"><span class="pre">layers.ini</span></tt> file is the layer configuration file. Its syntax is as
defined in the <a class="reference external" href="http://docs.python.org/library/configparser.html">documentation</a>  of the Python
Standard Library&#8217;s Configuration file parser module.</p>
<p>As an example, here is what would the description of a table named
<tt class="docutils literal"><span class="pre">users</span></tt> look like in the <tt class="docutils literal"><span class="pre">layers.ini</span></tt> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">users</span><span class="p">]</span>
<span class="n">singular</span><span class="o">=</span><span class="n">user</span>
<span class="n">plural</span><span class="o">=</span><span class="n">users</span>
<span class="n">table</span><span class="o">=</span><span class="n">users</span>
<span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span>
<span class="n">geomcolumn</span><span class="o">=</span><span class="n">the_geom</span>
<span class="n">geomtype</span><span class="o">=</span><span class="n">Point</span>
<span class="n">schema</span><span class="o">=</span><span class="n">people</span>
</pre></div>
</div>
<p>The name given in the square brackets, <tt class="docutils literal"><span class="pre">users</span></tt> in the above example, is
the identifier of the layer. It will be used in the command when generating
the web service.</p>
<p>We describe below each layer property:</p>
<dl class="last docutils">
<dt><tt class="docutils literal"><span class="pre">singular</span></tt></dt>
<dd>The <tt class="docutils literal"><span class="pre">singular</span></tt> property provides a singular name for the layer. This
is used by the framework for naming variables and classes in the
generated code.</dd>
<dt><tt class="docutils literal"><span class="pre">plural</span></tt></dt>
<dd>The <tt class="docutils literal"><span class="pre">plural</span></tt> property provides a plural name for the layer. Likewise
<tt class="docutils literal"><span class="pre">singular</span></tt> this is used by the framework for naming variables and
classes in the generated code.</dd>
<dt><tt class="docutils literal"><span class="pre">table</span></tt></dt>
<dd>The <tt class="docutils literal"><span class="pre">table</span></tt> property provides the name of database table.</dd>
<dt><tt class="docutils literal"><span class="pre">epsg</span></tt></dt>
<dd>The <tt class="docutils literal"><span class="pre">epsg</span></tt> property provides the EPSG code of the spatial reference
system (SRS) of the table data.</dd>
<dt><tt class="docutils literal"><span class="pre">geomcolumn</span></tt></dt>
<dd>The <tt class="docutils literal"><span class="pre">geomcolumn</span></tt> property provides the name of the table&#8217;s
geometry column.</dd>
<dt><tt class="docutils literal"><span class="pre">geomtype</span></tt> (optional)</dt>
<dd>The <tt class="docutils literal"><span class="pre">geomtype</span></tt> property provides the geometry type of the table&#8217;s
geometry column (for example <tt class="docutils literal"><span class="pre">Point</span></tt> or <tt class="docutils literal"><span class="pre">Polygon</span></tt>). If no value is
given, <tt class="docutils literal"><span class="pre">Geometry</span></tt> is used as geometry type.</dd>
<dt><tt class="docutils literal"><span class="pre">schema</span></tt> (optional)</dt>
<dd>The <tt class="docutils literal"><span class="pre">schema</span></tt> property provides the name of the table&#8217;s
schema.</dd>
</dl>
</dd>
<dt><tt class="docutils literal"><span class="pre">paster</span> <span class="pre">mf-layer</span></tt></dt>
<dd><p class="first">The second step involves entering the <tt class="docutils literal"><span class="pre">paster</span> <span class="pre">mf-layer</span></tt> command with the
layer identifier as the argument to the command. This command must be
entered from within the application&#8217;s main directory (<tt class="docutils literal"><span class="pre">HelloWorld</span></tt> in our
example).  The command used to generate the <tt class="docutils literal"><span class="pre">users</span></tt> web service is:</p>
<div class="highlight-python"><pre>(venv) $ paster mf-layer users</pre>
</div>
<p>The output of the command looks like this:</p>
<div class="highlight-python"><pre>Creating /home/elem/HelloWorld/helloworld/controllers/users.py
Creating /home/elem/HelloWorld/helloworld/tests/functional/test_users.py

To create the appropriate RESTful mapping, add a map statement to your
config/routing.py file in the CUSTOM ROUTES section like this:

map.resource("user", "users")

Creating /home/elem/HelloWorld/helloworld/model/users.py</pre>
</div>
<p>As indicated in the output the <tt class="docutils literal"><span class="pre">mf-layer</span></tt> command generates three files: a
controller file, a model file and a test file. The output also indicates to
edit the <tt class="docutils literal"><span class="pre">helloworld/config/routing.py</span></tt> file and add a route to the <tt class="docutils literal"><span class="pre">users</span></tt>
controller in this file. The CUSTOM ROUTES section should look like this:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="c"># CUSTOM ROUTES HERE</span>
<span class="nb">map</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="s">&quot;users&quot;</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;/{controller}/{action}&#39;</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;/{controller}/{action}/{id}&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p>You can now visit, for example, <a class="reference external" href="http://localhost:5000/users?limit=3">http://localhost:5000/users?limit=3</a> in your
browser. You should get a <a class="reference external" href="http://geojson.org">GeoJSON</a> representation of the
first three users of the <tt class="docutils literal"><span class="pre">users</span></tt> table. Look at the <a class="reference external" href="../protocol.html">Protocol page</a> to know more about parameters that can be passed to MapFish
web services.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p>Recommended reading:</p>
<ul class="last simple">
<li><a class="reference external" href="http://pylonsbook.com/en/1.0/urls-routing-and-dispatch.html">Pylons Book Chapter 9: URLs, Routing and Dispatch</a></li>
<li><a class="reference external" href="http://routes.groovie.org/">Routes docs</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="customizing-webservices.html" title="Customizing Web Services"
             >next</a> |</li>
        <li class="right" >
          <a href="javascript-toolbox.html" title="Installing the JavaScript toolbox"
             >previous</a> |</li>
        <li><a href="../index.html">MapFish v2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Framework</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Camptocamp.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>