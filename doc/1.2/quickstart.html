<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Quickstart &mdash; MapFish</title>
    
    <link rel="stylesheet" href="../../_static/mapfish.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="MapFish" href="../../index.html" />
    <link rel="up" title="Documentation MapFish 1.2" href="index.html" />
    <link rel="next" title="Framework" href="framework.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="framework.html" title="Framework"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">MapFish</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Documentation</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Documentation MapFish 1.2</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/mapfish_white.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Quickstart</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#creating-the-application">Creating the application</a><ul>
<li><a class="reference internal" href="#generating-the-base">Generating the base</a></li>
<li><a class="reference internal" href="#installing-the-javascript-toolbox">Installing the JavaScript toolbox</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-a-web-service">Creating a web service</a></li>
<li><a class="reference internal" href="#creating-search-functionality">Creating search functionality</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="framework.html"
                        title="next chapter">Framework</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/doc/1.2/quickstart.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="quickstart">
<span id="mapfish-refdoc-1-2-quickstart"></span><h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">MapFish 1.2 is not the latest MapFish version, refer to <a class="reference external" href="../../2.0/index.html">Documentation 2.0</a> for the documentation of the latest version.</p>
</div>
<p>A 20-minute quickstart to get a good sense of what MapFish is and what MapFish
provides.</p>
<p>With this quickstart you&#8217;ll understand how to create a MapFish application, a
basic user interface based on the JavaScript libraries provided by MapFish, and
MapFish web services.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Follow the instructions of the <a class="reference external" href="installation.html">installation page</a> and
come back here once done. Make sure the virtual Python environment is activated
before you proceed with the next section.</p>
</div>
<div class="section" id="creating-the-application">
<h2>Creating the application<a class="headerlink" href="#creating-the-application" title="Permalink to this headline">¶</a></h2>
<p>Here you&#8217;re going to use the framework to create your first MapFish
application.</p>
<div class="section" id="generating-the-base">
<h3>Generating the base<a class="headerlink" href="#generating-the-base" title="Permalink to this headline">¶</a></h3>
<p>Use:</p>
<div class="highlight-python"><div class="highlight"><pre>(env) $ paster create -t mapfish MapFishApp
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">MapFishApp</span></code> is the name of the MapFish application you&#8217;re creating, you can
pick any name of your choice. We&#8217;ll assume that you choose <code class="docutils literal"><span class="pre">MapFishApp</span></code> in
the rest of this quickstart.</p>
<p>When asked what template engine to use answer <code class="docutils literal"><span class="pre">mako</span></code>, which is the default.
When asked if SQLAlchemy 0.5 configuration is to be included, answer <code class="docutils literal"><span class="pre">True</span></code>,
as your MapFish application will include web services relying on database
tables.</p>
<p>You should now have a folder named <code class="docutils literal"><span class="pre">MapFishApp</span></code>. This folder contains your
application files.</p>
<p>Now check that your MapFish application works. For this go into the
<code class="docutils literal"><span class="pre">MapFishApp</span></code> folder and start the application:</p>
<div class="highlight-python"><div class="highlight"><pre>(env) $ cd MapFishApp
(env) $ paster serve development.ini
</pre></div>
</div>
<p>This command starts your application in the Paster web server, which is a
pure-Python web server commonly used during development.</p>
<p>Open <a class="reference external" href="http://localhost:5000">http://localhost:5000</a> in your web browser, you should get the default
page:</p>
<a class="reference internal image-reference" href="../../_images/pylons.png"><img alt="../../_images/pylons.png" src="../../_images/pylons.png" style="width: 500pt; height: 300pt;" /></a>
</div>
<div class="section" id="installing-the-javascript-toolbox">
<h3>Installing the JavaScript toolbox<a class="headerlink" href="#installing-the-javascript-toolbox" title="Permalink to this headline">¶</a></h3>
<p>You are now going to install the MapFish JavaScript toolbox in your
application. This toolbox includes:</p>
<ul class="simple">
<li>the Ext, OpenLayers, GeoExt and MapFish Client JavaScript libraries,</li>
<li>a sample JavaScript application based on those libraries,</li>
<li>a build profile for minifying the JavaScript code of this sample
application,</li>
<li>a JavaScript testing framework, with a test example</li>
</ul>
<p>Enter <code class="docutils literal"><span class="pre">Ctrl+C</span></code> to stop the Paster server and proceed with these
commands:</p>
<div class="highlight-python"><div class="highlight"><pre>(env) $ cd ..
(env) $ paster create -t mapfish_client MapFishApp
</pre></div>
</div>
<p>When asked whether to overwrite <code class="docutils literal"><span class="pre">index.html</span></code> answer <code class="docutils literal"><span class="pre">y</span></code>. This will
overwrite the <code class="docutils literal"><span class="pre">index.html</span></code> page you saw in the last section by the one
provided by the <code class="docutils literal"><span class="pre">mapfish_client</span></code> template. When asked whether to overwrite
<code class="docutils literal"><span class="pre">favicon.png</span></code> also answer <code class="docutils literal"><span class="pre">y</span></code>.</p>
<p>Start the application again:</p>
<div class="highlight-python"><div class="highlight"><pre>(env) $ cd MapFishApp
(env) $ paster serve --reload development.ini
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note the use of the <code class="docutils literal"><span class="pre">--reload</span></code> switch. This switch makes the Paste server
monitor all Python modules used by the <code class="docutils literal"><span class="pre">MapFishApp</span></code> application and
reload itself automatically if any of them is modified or if new modules
are created. This is especially useful during development.</p>
</div>
<p>Open or reload <a class="reference external" href="http://localhost:5000">http://localhost:5000</a> in your web browser, you should now get
the default user interface:</p>
<a class="reference internal image-reference" href="../../_images/osm.png"><img alt="../../_images/osm.png" src="../../_images/osm.png" style="width: 500pt; height: 300pt;" /></a>
<p>This default user interface is composed of: a map, a toolbar above the map with
tools acting on the map, and a layer tree for controlling the visibility of
layers. The map itself is composed of two <a class="reference external" href="http://openstreetmap.org">OpenStreetMap</a> layers.</p>
<p>The default user interface is provided to the application developer as an
example. The application developer is free to build on it, or delete it to
write his own if he wants.</p>
</div>
</div>
<div class="section" id="creating-a-web-service">
<h2>Creating a web service<a class="headerlink" href="#creating-a-web-service" title="Permalink to this headline">¶</a></h2>
<p>MapFish provides a command for generating web services implementing the
<a class="reference external" href="protocol.html">MapFish Protocol</a>. A MapFish web service relies on
geographic database table.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only PostGIS tables are currently supported.</p>
</div>
<p>Before creating web services you need to set up the connection to the
geographic database. For this quickstart an existing public database will be
used. In real-life scenarios, the database system and the MapFish application
execute on the same host or on hosts of the same private network.</p>
<p>To set up the database connection edit <code class="docutils literal"><span class="pre">development.ini</span></code> and replace the line</p>
<div class="highlight-python"><div class="highlight"><pre>sqlalchemy.url = sqlite:///%(here)s/development.db
</pre></div>
</div>
<p>by this one:</p>
<div class="highlight-python"><div class="highlight"><pre>sqlalchemy.url = postgres://quickstart:quickstart@www.mapfish.org:5432/quickstart
</pre></div>
</div>
<p>The connection string specifies that the <code class="docutils literal"><span class="pre">postgres</span></code> driver must be used, the
database system is located at <code class="docutils literal"><span class="pre">www.mapfish.org</span></code> on port <code class="docutils literal"><span class="pre">5432</span></code>, and the
name of the database is <code class="docutils literal"><span class="pre">quickstart</span></code>.</p>
<p>Now that the database connection is set up, you&#8217;re ready to create the web
service. Creating a web service is done in three steps:</p>
<ol class="arabic">
<li><p class="first">create a layer configuration in the <code class="docutils literal"><span class="pre">layers.ini</span></code> file, in our case we&#8217;re
going rely on the table named <code class="docutils literal"><span class="pre">countries</span></code> in the database, so the
configuration is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">countries</span><span class="p">]</span>
<span class="n">singular</span><span class="o">=</span><span class="n">country</span>
<span class="n">plural</span><span class="o">=</span><span class="n">countries</span>
<span class="n">table</span><span class="o">=</span><span class="n">countries</span>
<span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span>
<span class="n">geomcolumn</span><span class="o">=</span><span class="n">the_geom</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">singular</span></code> provides a <code class="docutils literal"><span class="pre">singular</span></code> name for the layer. <code class="docutils literal"><span class="pre">plural</span></code> provides
a plural name for the layer. Both are used by the code generator when
substituting variables. <code class="docutils literal"><span class="pre">table</span></code> provides the name of the database.
<code class="docutils literal"><span class="pre">epsg</span></code> provides the coordinate system of the table data. <code class="docutils literal"><span class="pre">geomcolumn</span></code>
provides the name of the geometry column.</p>
</li>
<li><p class="first">generate the web service code with the <code class="docutils literal"><span class="pre">mf-layer</span></code> command:</p>
<div class="highlight-python"><div class="highlight"><pre>(env) $ paster mf-layer countries
</pre></div>
</div>
</li>
<li><p class="first">configure a route to the <code class="docutils literal"><span class="pre">countries</span></code> controller, this is done by adding
the following statement after the &#8220;CUSTOM ROUTES HERE&#8221; comment in the
<code class="docutils literal"><span class="pre">mapfishapp/config/routing.py</span></code> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&quot;country&quot;</span><span class="p">,</span> <span class="s">&quot;countries&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>Watch the indentation! 4 spaces are needed here.</p>
<p>If you stopped <code class="docutils literal"><span class="pre">paster</span> <span class="pre">serve</span></code> or if you did not add the <code class="docutils literal"><span class="pre">--reload</span></code> switch,
restart <code class="docutils literal"><span class="pre">MapFishApp</span></code> with:</p>
<div class="highlight-python"><div class="highlight"><pre>(env) $ paster serve --reload development.ini
</pre></div>
</div>
<p>You can now open <a class="reference external" href="http://localhost:5000/countries?limit=1">http://localhost:5000/countries?limit=1</a> in your browser, you
should see a <a class="reference external" href="http://geojson.org">GeoJSON</a> representation of the first object
in the <code class="docutils literal"><span class="pre">countries</span></code> table:</p>
<a class="reference internal image-reference" href="../../_images/geojson.png"><img alt="../../_images/geojson.png" src="../../_images/geojson.png" style="width: 500pt; height: 300pt;" /></a>
</div>
<div class="section" id="creating-search-functionality">
<h2>Creating search functionality<a class="headerlink" href="#creating-search-functionality" title="Permalink to this headline">¶</a></h2>
<p>Now that the <code class="docutils literal"><span class="pre">countries</span></code> web service works, let&#8217;s create a search
functionality based on that web service. This search functionality will involve
displaying a popup containing information about the country that is clicked by
the user.</p>
<p>Edit the <code class="docutils literal"><span class="pre">mapfishapp/public/app/js/mapfishapp_layout.js</span></code> file, look up the
<code class="docutils literal"><span class="pre">createTbarItems()</span></code> function, and insert a new <code class="docutils literal"><span class="pre">GeoExt.Action</span></code> to the array
returned by the function by adding the following code to the function (If
unsure, see this <a class="reference download internal" href="../../_downloads/mapfishapp_layout.js"><code class="xref download docutils literal"><span class="pre">file</span></code></a>):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">actions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">GeoExt</span><span class="p">.</span><span class="nx">Action</span><span class="p">({</span>
    <span class="nx">iconCls</span><span class="o">:</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span>
    <span class="nx">map</span><span class="o">:</span> <span class="nx">map</span><span class="p">,</span>
    <span class="nx">toggleGroup</span><span class="o">:</span> <span class="s2">&quot;tools&quot;</span><span class="p">,</span>
    <span class="nx">allowDepress</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">tooltip</span><span class="o">:</span> <span class="s2">&quot;Query&quot;</span><span class="p">,</span>
    <span class="nx">control</span><span class="o">:</span> <span class="k">new</span> <span class="nx">mapfish</span><span class="p">.</span><span class="nx">Searcher</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;countries&quot;</span><span class="p">,</span>
        <span class="nx">protocol</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">params</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">epsg</span><span class="o">:</span> <span class="s2">&quot;900913&quot;</span><span class="p">,</span>
                <span class="nx">attrs</span><span class="o">:</span> <span class="s2">&quot;pays,continent&quot;</span><span class="p">,</span>
                <span class="nx">no_geom</span><span class="o">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">displayDefaultPopup</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">})</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>In the above code a <code class="docutils literal"><span class="pre">GeoExt.Action</span></code> configured with <code class="docutils literal"><span class="pre">mapfish.Searcher.Map</span></code>
is added to the array of actions. The <code class="docutils literal"><span class="pre">mapfish.Searcher.Map</span></code> object is
connected to the <code class="docutils literal"><span class="pre">countries</span></code> web service through the <code class="docutils literal"><span class="pre">url</span></code> option. In this
example the <code class="docutils literal"><span class="pre">mapfish.Searcher.Map</span></code> object displays a default popup containing
the name of the clicked country, and the name of is continent.</p>
<a class="reference internal image-reference" href="../../_images/query.png"><img alt="../../_images/query.png" src="../../_images/query.png" style="width: 500pt; height: 300pt;" /></a>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="framework.html" title="Framework"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">MapFish</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Documentation</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Documentation MapFish 1.2</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2009, Camptocamp.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>